--- a/routes/v1/video/caption_video.py
+++ b/routes/v1/video/caption_video.py
@@
-    upload_url = upload_file(output)
-    return jsonify({"status": "success", "output_url": upload_url}), 200
+    # Новый код: поддержка output_dir
+    output_dir = data.get("output_dir")
+    upload_url = upload_file(output, output_dir=output_dir)
+    return jsonify({"status": "success", "output_url": upload_url}), 200
--- a/services/cloud_storage.py
+++ b/services/cloud_storage.py
@@
-class S3CompatibleProvider(CloudStorageProvider):
-    def __init__(self):
+class S3CompatibleProvider(CloudStorageProvider):
+    def __init__(self):
         self.endpoint_url = os.getenv('S3_ENDPOINT_URL')
         self.access_key = os.getenv('S3_ACCESS_KEY')
         self.secret_key = os.getenv('S3_SECRET_KEY')
         self.bucket_name = os.environ.get('S3_BUCKET_NAME', '')
         self.region = os.environ.get('S3_REGION', '')
-    def upload_file(self, file_path: str) -> str:
-        return upload_to_s3(file_path, self.endpoint_url, self.access_key, self.secret_key, self.bucket_name, self.region)
+    def upload_file(self, file_path: str, output_dir: str = None) -> str:
+        return upload_to_s3(
+            file_path,
+            self.endpoint_url,
+            self.access_key,
+            self.secret_key,
+            self.bucket_name,
+            self.region,
+            output_dir
+        )
--- a/services/s3_toolkit.py
+++ b/services/s3_toolkit.py
@@
-def upload_to_s3(file_path, s3_url, access_key, secret_key, bucket_name, region):
-    session = boto3.Session(
-        aws_access_key_id=access_key,
-        aws_secret_access_key=secret_key,
-        region_name=region
-    )
-    client = session.client('s3', endpoint_url=s3_url)
-
-    with open(file_path, 'rb') as data:
-        client.upload_fileobj(data, bucket_name, os.path.basename(file_path), ExtraArgs={'ACL': 'public-read'})
-
-    encoded_filename = quote(os.path.basename(file_path))
-    file_url = f"{s3_url}/{bucket_name}/{encoded_filename}"
-    return file_url
+def upload_to_s3(file_path, s3_url, access_key, secret_key, bucket_name, region, output_dir=None):
+    import os
+    from urllib.parse import quote
+    import boto3
+
+    session = boto3.Session(
+        aws_access_key_id=access_key,
+        aws_secret_access_key=secret_key,
+        region_name=region
+    )
+    client = session.client('s3', endpoint_url=s3_url)
+
+    basename = os.path.basename(file_path)
+
+    # Формируем путь в бакете
+    if output_dir:
+        if not output_dir.endswith("/"):
+            output_dir += "/"
+        output_s3_path = output_dir + basename
+    else:
+        output_s3_path = basename
+
+    with open(file_path, 'rb') as data:
+        client.upload_fileobj(data, bucket_name, output_s3_path, ExtraArgs={'ACL': 'public-read'})
+
+    encoded_key = quote(output_s3_path)
+    return f"{s3_url}/{bucket_name}/{encoded_key}"
